# Быстрый старт / Quick Start Guide

Руководство по быстрому запуску CAN LED контроллера.

## Содержание

1. [Что вам понадобится](#что-вам-понадобится)
2. [Сборка за 10 минут](#сборка-за-10-минут)
3. [Прошивка](#прошивка)
4. [Проверка работы](#проверка-работы)
5. [Тестирование с эмулятором](#тестирование-с-эмулятором)

---

## Что вам понадобится

### Оборудование

| Компонент | Описание | Примерная цена |
|-----------|----------|----------------|
| **TTGO T-CAN48** | ESP32 плата со встроенным CAN трансивером | ~$15 |
| **LED лента WS2812B** | Адресная лента на 60 светодиодов | ~$5-10 |
| **Блок питания 5V** | Минимум 3A для 60 LED | ~$5 |
| **Провода** | Для подключения CAN и LED | ~$2 |
| **Резистор 120Ω** | CAN терминатор (если нет на шине) | ~$0.1 |

### Инструменты

- USB кабель для программирования
- Отвёртка для клеммников
- Мультиметр (опционально)

### Программное обеспечение

- [PlatformIO](https://platformio.org/) (VSCode extension или CLI)
- [Python 3.8+](https://python.org/) (для эмулятора)
- Драйверы CH340/CP2102 (для USB-Serial)

---

## Сборка за 10 минут

### Шаг 1: Подключение LED ленты

```
TTGO T-CAN48          LED Strip WS2812B
┌─────────────┐       ┌─────────────────┐
│             │       │                 │
│    GPIO4 ───┼───────┤─── DIN          │
│             │       │                 │
│    5V ──────┼───────┤─── +5V          │
│             │       │                 │
│    GND ─────┼───────┤─── GND          │
│             │       │                 │
└─────────────┘       └─────────────────┘
```

> **Важно**: Для лент более 30 LED используйте внешний блок питания 5V, подключая GND к общей земле.

### Шаг 2: Подключение CAN шины

```
TTGO T-CAN48          Устройство с CAN
(Terminal Block)      (ECU, OBD адаптер)
┌─────────────┐       ┌─────────────────┐
│             │       │                 │
│   CAN_H ────┼───────┤─── CAN High     │
│             │       │                 │
│   CAN_L ────┼───────┤─── CAN Low      │
│             │       │                 │
│   GND ──────┼───────┤─── GND          │
│             │       │                 │
└─────────────┘       └─────────────────┘
        │
        │ (между CAN_H и CAN_L)
       ┌┴┐
       │ │ 120Ω терминатор
       └─┘  (если нужен)
```

### Шаг 3: Питание

**Вариант A - USB питание** (для тестирования до 30 LED):
- Просто подключите USB кабель

**Вариант B - Внешнее питание** (для длинных лент):
```
Блок питания 5V/5A
┌─────────────────┐
│                 │
│  +5V ───────────┼──────┬──── LED +5V
│                 │      │
│                 │      └──── TTGO 5V (опционально)
│                 │
│  GND ───────────┼──────┬──── LED GND
│                 │      │
│                 │      └──── TTGO GND
└─────────────────┘
```

---

## Прошивка

### Установка PlatformIO

```bash
# Установка через pip
pip install platformio

# Или используйте VSCode extension "PlatformIO IDE"
```

### Клонирование и сборка

```bash
# Клонируйте репозиторий
git clone https://github.com/your-repo/canbus_led.git
cd canbus_led

# Выберите протокол в src/config.h:
# #define CAN_PROTOCOL 0  // Custom Protocol
# #define CAN_PROTOCOL 1  // Link ECU Generic Dashboard (по умолчанию)
# #define CAN_PROTOCOL 2  // Link ECU Generic Dashboard 2

# Соберите прошивку
pio run

# Прошейте устройство
pio run --target upload --upload-port /dev/ttyUSB0
```

### Проверка подключения порта

```bash
# Linux
ls /dev/ttyUSB* /dev/ttyACM*

# macOS
ls /dev/cu.usb*

# Windows
# Посмотрите в Device Manager → Ports (COM & LPT)
```

---

## Проверка работы

### Монитор Serial

```bash
pio device monitor -b 115200
```

Вы должны увидеть:
```
TWAI driver installed
CAN bus started at 1 Mbps
WiFi AP started: CANLED_AP
HTTP server started on port 80
```

### Индикация на LED при старте

1. **Первый LED мигает RGB** (0.5 сек) - самотест
2. **Лента тёмная** - ожидание CAN данных
3. **Янтарное дыхание** - зажигание включено, двигатель заглушен

### Веб-интерфейс

1. Подключитесь к WiFi: **CANLED_AP** (пароль: `canled123`)
2. Откройте браузер: **http://192.168.4.1/**
3. Вы увидите:
   - Текущие параметры автомобиля
   - Историю CAN сообщений
   - Статус системы

---

## Тестирование с эмулятором

Если у вас нет доступа к реальной CAN шине, используйте эмулятор.

### Установка эмулятора

```bash
cd tools/can_emulator
pip install -r requirements.txt
```

### Запуск

```bash
python can_emulator.py
```

### Подключение USB-CAN адаптера

1. Подключите адаптер (CANable, USBtin, PCAN и т.д.)
2. В эмуляторе выберите:
   - **Interface**: `slcan` (для большинства USB адаптеров)
   - **Channel**: `/dev/ttyUSB0` или `COM3`
   - **Bitrate**: `1000000`
3. Нажмите **Connect**
4. Выберите протокол (должен совпадать с прошивкой!)
5. Нажмите **Start Sending**

### Быстрый тест без адаптера

Используйте режим **virtual**:
1. Interface: `virtual`
2. Сообщения логируются, но не отправляются
3. Полезно для проверки формата данных

### Пресеты для тестирования

| Пресет | Что тестирует |
|--------|---------------|
| **Idle** | Базовое состояние (800 RPM) |
| **Cruising** | Движение (3000 RPM, 80 km/h) |
| **Hard Acceleration** | Разгон (5500 RPM, 100% газ) |
| **Rev Limiter** | Отсечка (жёлтое пульсирование) |
| **Cold Start** | Прогрев (синее дыхание) |
| **Oil Warning** | Паника (красно-белая строба) |

---

## Следующие шаги

- [Подробная настройка оборудования](HARDWARE_SETUP.md)
- [Руководство по эмулятору](EMULATOR_GUIDE.md)
- [Интеграция с Link ECU](LINK_ECU_INTEGRATION.md)
- [CAN протокол](CAN_PROTOCOL.md)
- [Сценарии использования](USAGE_SCENARIOS.md)

---

## Частые проблемы

### LED не загорается

1. Проверьте подключение GPIO4 → DIN
2. Проверьте питание LED ленты
3. Убедитесь, что первый LED мигает при старте

### CAN данные не приходят

1. Проверьте полярность CAN_H/CAN_L
2. Убедитесь в наличии терминатора 120Ω
3. Проверьте скорость шины (должна быть 1 Mbps)
4. Проверьте Serial Monitor на ошибки

### WiFi не подключается

1. SSID: `CANLED_AP`
2. Пароль: `canled123`
3. IP адрес: `192.168.4.1`

---

**Готово!** Теперь у вас работающий CAN LED контроллер.
