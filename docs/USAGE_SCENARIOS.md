# Сценарии использования / Usage Scenarios

Практические примеры применения CAN LED контроллера в различных ситуациях.

## Содержание

1. [Трек-дни и автоспорт](#трек-дни-и-автоспорт)
2. [Дрэг-рейсинг](#дрэг-рейсинг)
3. [Дрифт](#дрифт)
4. [Ежедневная эксплуатация](#ежедневная-эксплуатация)
5. [Мотоциклы](#мотоциклы)
6. [Диагностика и отладка](#диагностика-и-отладка)

---

## Трек-дни и автоспорт

### Настройка для трека

```
Рекомендуемые параметры:

┌─ config.h ──────────────────────────────────┐
│ #define CAN_PROTOCOL 1  // Link ECU         │
│                                             │
│ // Настройка redline под ваш мотор:         │
│ state.rpmRedline = 7200;  // Для турбо 4цил │
│                                             │
│ // Shift light:                             │
│ userConfig.shiftLightRpm = 6800;            │
│                                             │
│ // Высокая яркость:                         │
│ LED_BRIGHTNESS = 200;                       │
└─────────────────────────────────────────────┘
```

### Визуализация на треке

```
Типичный круг:

1. СТАРТ (Pit Lane)
   ┌─────────────────────────────────────────┐
   │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │  ← Янтарное дыхание
   └─────────────────────────────────────────┘     (двигатель на холостых)

2. РАЗГОН (Прямая)
   ┌─────────────────────────────────────────┐
   │ ███████████████████░░░░░░░░░░░░░░░░░░░ │  ← Зелёная полоса (газ 80%)
   │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░ │  ← RPM градиент (5000 RPM)
   └─────────────────────────────────────────┘

3. МАКСИМАЛЬНЫЕ ОБОРОТЫ
   ┌─────────────────────────────────────────┐
   │ ████████████████████████████████████████│  ← Газ 100%
   │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│  ← Жёлтый (6500+ RPM)
   │ ≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋│  ← Пульсация (отсечка)
   └─────────────────────────────────────────┘

4. SHIFT LIGHT (Переключение)
   ┌─────────────────────────────────────────┐
   │ ░░░░░░███░░░░░░███░░░░░░███░░░░░░███░░░│  ← Синие вспышки
   └─────────────────────────────────────────┘     (пора переключаться!)

5. ТОРМОЖЕНИЕ (Перед поворотом)
   ┌─────────────────────────────────────────┐
   │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│  ← Красный оверлей (тормоз)
   └─────────────────────────────────────────┘
```

### Монтаж для трека

```
                       Cockpit View
    ┌───────────────────────────────────────────┐
    │                                           │
    │    ┌─────────────────────────────────┐    │
    │    │░░░░░░░░░░░LED░░░░░░░░░░░░░░░░░░░│    │  ← Под рулём
    │    └─────────────────────────────────┘    │
    │                                           │
    │         ╔═══════════════════╗             │
    │         ║                   ║             │
    │         ║       РУЛЬ        ║             │
    │         ║                   ║             │
    │         ╚═══════════════════╝             │
    │                                           │
    │  ┌─────────────────────────────────────┐  │
    │  │        Приборная панель             │  │
    │  └─────────────────────────────────────┘  │
    │                                           │
    └───────────────────────────────────────────┘

Преимущества расположения под рулём:
✓ В поле зрения без отвода взгляда
✓ Периферийное зрение улавливает изменения
✓ Не мешает обзору дороги
```

### Анализ после заезда

```bash
# Подключитесь к WiFi: CANLED_AP
# Откройте: http://192.168.4.1/api/stats

Пример статистики:
{
  "max_rpm": 7250,           // Макс. обороты
  "max_coolant_temp": 98,    // Макс. температура
  "min_oil_pressure": 28,    // Мин. давление масла (×0.1 bar)
  "rev_limiter_hits": 12,    // Срабатываний отсечки
  "avg_rpm": 4850,           // Средние обороты
  "hard_braking_events": 24  // Резких торможений
}
```

---

## Дрэг-рейсинг

### Настройка для дрэга

```
Ключевые параметры:

┌─ config.h ──────────────────────────────────┐
│ // Высокий redline для дрэга:               │
│ state.rpmRedline = 8500;                    │
│                                             │
│ // Shift light близко к отсечке:            │
│ userConfig.shiftLightRpm = 8200;            │
│                                             │
│ // Максимальная яркость:                    │
│ LED_BRIGHTNESS = 255;                       │
└─────────────────────────────────────────────┘
```

### Launch Control индикация

```
Процедура старта:

1. STAGING (Ожидание)
   ┌─────────────────────────────────────────┐
   │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│  ← Янтарное дыхание
   └─────────────────────────────────────────┘

2. LAUNCH CONTROL ARMED (Готовность)
   ┌─────────────────────────────────────────┐
   │ ████████████████████████████████████████│  ← 100% газ
   │ ≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋│  ← Launch RPM (пульс)
   └─────────────────────────────────────────┘

   launch_control = 1
   rpm = launch_rpm_limit (обычно 4000-5000)

3. GO! (Старт)
   ┌─────────────────────────────────────────┐
   │ ████████████████████████████████████████│  ← Полный газ
   │ ░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│  ← RPM растёт быстро
   └─────────────────────────────────────────┘

4. SHIFT (Переключение)
   ┌─────────────────────────────────────────┐
   │ ░░░███░░░███░░░███░░░███░░░███░░░███░░░│  ← Shift light!
   │ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│  ← Макс RPM
   └─────────────────────────────────────────┘
```

### Flat Shift (для секвентальных КПП)

```
При активации flat shift:

flat_shift = 1

┌─────────────────────────────────────────┐
│ ≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈≈│  ← Специальная анимация
└─────────────────────────────────────────┘     (мгновенное переключение)
```

---

## Дрифт

### Настройка для дрифта

```
Особенности:

1. ALS (Anti-Lag System) — для турбо машин:
   als_active = 1 при сбросе газа → янтарное пульсирование

2. Handbrake — частое использование:
   Фиолетовый оверлей на левой части ленты

3. Быстрые переходы газ/тормоз:
   Рекомендуется интервал 20-30ms для RPM и Throttle
```

### Визуализация дрифта

```
INITIATION (Вход в занос)

Handbrake pull:
┌─────────────────────────────────────────┐
│ █████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│  ← Фиолетовый (handbrake)
│ ░░░░░▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░│  ← Зелёный (50% газ)
└─────────────────────────────────────────┘

DRIFT (Поддержание угла)

Throttle + Counter-steer:
┌─────────────────────────────────────────┐
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░│  ← RPM 5000-6000
│ ████████████████████████████░░░░░░░░░░░░│  ← Газ 70%
│ ≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋░░░░░░░░░░│  ← ALS активен (янтарь)
└─────────────────────────────────────────┘

TRANSITION (Переход)

Lift-off + ALS:
┌─────────────────────────────────────────┐
│ ≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋│  ← Янтарное пульсирование
└─────────────────────────────────────────┘     (ALS держит турбину)
```

---

## Ежедневная эксплуатация

### Настройка для города

```
┌─ config.h ──────────────────────────────────┐
│ // Комфортные настройки:                    │
│ LED_BRIGHTNESS = 100;       // Не слепит    │
│                                             │
│ // Автоматический ночной режим:             │
│ userConfig.autoNightMode = true;            │
│ userConfig.nightModeBrightness = 40;        │
│ userConfig.nightModeStartHour = 20;         │
│ userConfig.nightModeEndHour = 6;            │
└─────────────────────────────────────────────┘
```

### Полезные индикации

```
1. ПРОГРЕВ ДВИГАТЕЛЯ

   Синее "дыхание" пока coolant < 60°C:
   ┌─────────────────────────────────────────┐
   │ ░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░│  ← Breathing blue
   └─────────────────────────────────────────┘

   Напоминание: не крутить мотор!

2. ПЕРЕГРЕВ

   Красный последний LED при coolant > 100°C:
   ┌─────────────────────────────────────────┐
   │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█│  ← Красный!
   └─────────────────────────────────────────┘

   Предупреждение: остановитесь!

3. НИЗКОЕ ДАВЛЕНИЕ МАСЛА

   Красно-белый строб при oil < 2 bar && throttle > 40%:
   ┌─────────────────────────────────────────┐
   │ ██░░██░░██░░██░░██░░██░░██░░██░░██░░██│  ← PANIC!
   └─────────────────────────────────────────┘

   КРИТИЧНО: немедленно заглушите двигатель!

4. ТЕМПЕРАТУРА ОХЛАЖДАЮЩЕЙ ЖИДКОСТИ

   Последний LED показывает градиент:
   60°C = Синий   │████│
   85°C = Зелёный │████│  ← Норма
   100°C = Жёлтый │████│
   110°C = Красный│████│  ← Перегрев!
```

### Ночной режим

```
День (яркость 100%):
┌─────────────────────────────────────────┐
│ ████████████████████████████████████████│
└─────────────────────────────────────────┘

Ночь (яркость 40%):
┌─────────────────────────────────────────┐
│ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░│  ← Приглушённо
└─────────────────────────────────────────┘

Автопереключение:
- 20:00 → ночной режим включается
- 06:00 → дневной режим включается
```

---

## Мотоциклы

### Особенности установки на мотоцикл

```
Варианты расположения LED:

1. ПОД ПРИБОРНОЙ ПАНЕЛЬЮ
   ┌─────────────────────────────┐
   │    ┌───────────────────┐    │
   │    │   Спидометр       │    │
   │    │   Тахометр        │    │
   │    └───────────────────┘    │
   │    ░░░░░░░░LED░░░░░░░░░░    │  ← Компактная лента
   └─────────────────────────────┘

2. ПОД БАКОМ
   ┌─────────────────────────────┐
   │         ╔═══════╗           │
   │         ║  БАК  ║           │
   │         ╚═══════╝           │
   │    ░░░░░░░░LED░░░░░░░░░░    │  ← Подсветка снизу
   └─────────────────────────────┘

3. НА РАМКЕ ЗЕРКАЛА (для SHIFT LIGHT)
   ┌───┐                     ┌───┐
   │███│                     │███│  ← Только shift light
   └─┬─┘                     └─┬─┘
     │                         │
   ┌─┴─────────────────────────┴─┐
   │        Приборка             │
   └─────────────────────────────┘
```

### Защита от влаги

```
Обязательно:
- IP65+ LED лента (силиконовое покрытие)
- Герметичный корпус для контроллера
- Водонепроницаемые разъёмы
- Дренажные отверстия снизу корпуса

Пример герметизации:
┌────────────────────────────────────┐
│                                    │
│  ┌──────────────────────────────┐  │
│  │  TTGO T-CAN48                │  │  ← Плата в корпусе
│  │  + DC-DC                     │  │
│  └──────────────────────────────┘  │
│                                    │
│  ══════════════════════════════   │  ← Герметик по краю
│                                    │
│  ○ ○ ○  ← Сальники для проводов   │
│                                    │
└────────────────────────────────────┘
  IP67 пластиковый корпус
```

### Настройки для мотоцикла

```
┌─ config.h ──────────────────────────────────┐
│ // Высокий redline для спортбайков:         │
│ state.rpmRedline = 14000;  // CBR, R1, etc  │
│                                             │
│ // Shift light:                             │
│ userConfig.shiftLightRpm = 13500;           │
│                                             │
│ // Меньше LED (компактность):               │
│ LED_COUNT = 30;                             │
│                                             │
│ // Высокая яркость (видно на солнце):       │
│ LED_BRIGHTNESS = 255;                       │
└─────────────────────────────────────────────┘
```

---

## Диагностика и отладка

### Тестирование без CAN

Используйте эмулятор в режиме `virtual`:

```bash
cd tools/can_emulator
python can_emulator.py

# В эмуляторе:
# Interface: virtual
# Channel: test
# [Connect]

# Теперь можете менять значения и видеть в логе,
# какие данные отправлялись бы
```

### Проверка LED последовательно

```
Тест-план проверки всех эффектов:

[ ] 1. Самотест при включении
      → Первый LED: R → G → B (0.5 сек)

[ ] 2. Ignition standby
      → Янтарное дыхание
      → Установите: ignition=1, rpm=0

[ ] 3. Холодный пуск
      → Синее дыхание
      → Установите: coolant=30°C

[ ] 4. Throttle bar
      → Зелёная полоса
      → Меняйте: throttle 0% → 100%

[ ] 5. RPM gradient
      → Синий → жёлтый → красный
      → Меняйте: rpm 0 → redline

[ ] 6. Rev limiter
      → Жёлтое пульсирование
      → Установите: rpm=redline, rev_limiter=1

[ ] 7. Brake overlay
      → Красный оверлей
      → Установите: brake 0% → 100%

[ ] 8. Clutch overlay
      → Голубой справа
      → Установите: clutch 0% → 100%

[ ] 9. Handbrake overlay
      → Фиолетовый слева
      → Установите: handbrake 0% → 100%

[ ] 10. Coolant indicator
       → Последний LED меняет цвет
       → Меняйте: coolant 60°C → 110°C

[ ] 11. Oil panic
       → Красно-белый строб
       → Установите: throttle=50%, oil_pressure=0.5bar

[ ] 12. Shift light
       → Синие вспышки
       → Установите: rpm = shiftLightRpm
```

### Мониторинг в реальном времени

```bash
# Терминал 1: Serial monitor
pio device monitor -b 115200

# Терминал 2: Веб-интерфейс
curl http://192.168.4.1/api/state | jq

# Терминал 3: WebSocket (если включен)
wscat -c ws://192.168.4.1:81
```

### Логирование CAN сообщений

Из эмулятора:
```
Меню → File → Export Log...

Формат лога:
10:30:45.123 TX 0x5F0 [6] 20 03 00 00 E8 03
│            │  │     │   └─ Данные (hex)
│            │  │     └─ DLC (длина)
│            │  └─ CAN ID
│            └─ Направление (TX/RX)
└─ Время
```

---

## Чеклист перед использованием

### Перед поездкой

- [ ] LED лента работает (самотест при включении)
- [ ] CAN данные принимаются (Serial monitor)
- [ ] WiFi AP запустился (видно в списке сетей)
- [ ] Яркость настроена правильно (день/ночь)
- [ ] Redline установлен для вашего мотора
- [ ] Shift light RPM настроен

### Перед треком

- [ ] Проверена визуализация всех эффектов (эмулятором)
- [ ] Яркость на максимум
- [ ] Батарея заряжена / питание надёжно
- [ ] Провода закреплены и не болтаются
- [ ] LED видна из позиции пилота

### После сессии

- [ ] Проверить статистику: http://192.168.4.1/api/stats
- [ ] Экспортировать данные при необходимости
- [ ] Сбросить статистику для следующей сессии
- [ ] Проверить состояние оборудования

---

**Готово к использованию!**

Дополнительные ресурсы:
- [Быстрый старт](QUICK_START.md)
- [Настройка оборудования](HARDWARE_SETUP.md)
- [Руководство по эмулятору](EMULATOR_GUIDE.md)
- [Интеграция с Link ECU](LINK_ECU_INTEGRATION.md)
